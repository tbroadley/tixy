<html>
  <head>
    <style>
      body {
        background-color: black;
      }

      #root {
        margin-bottom: 16px;
      }

      #root > div {
        display: flex;
        flex-direction: row;;
        height: 16px;
      }

      #root > div > canvas {
        width: 16px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <input type="text" id="formula" value="Math.sin(y/8 + t)" />

    <script>
      const root = document.getElementById("root");

      const rows = [];

      for (let y = 0; y < 16; y += 1) {
        const row = document.createElement("div");
        root.appendChild(row);

        const rowArray = [];

        for (let x = 0; x < 16; x += 1) {
          const cell = document.createElement("canvas");
          cell.setAttribute("width", "100");
          cell.setAttribute("height", "100");
          row.appendChild(cell);

          rowArray.push(cell);
        }

        rows.push(rowArray);
      }

      const startTime = Date.now();

      const update = () => {
        const now = Date.now();
        const t = (now - startTime) / 1_000;

        for (let y = 0; y < 16; y += 1) {
          for (let x = 0; x < 16; x += 1) {
            const i = 16 * y + x;

            let radius;
            try {
              const formula = `with(Math) { ${document.getElementById("formula").value} }`;
              radius = eval(formula);
            } catch {
              radius = 0;
            }
            if (radius > 1) radius = 1;
            if (radius < -1) radius = -1;

            const canvas = rows[y][x];
            const context = canvas.getContext("2d");
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.beginPath();
            context.arc(canvas.width/2, canvas.height/2, (0.9*canvas.width)/2 * Math.abs(radius), 0, 2 * Math.PI);
            context.fillStyle = radius >= 0 ? "white" : "red";
            context.fill();
          }
        }

        requestAnimationFrame(update);
      }

      requestAnimationFrame(update);
    </script>
  </body>
</html>
